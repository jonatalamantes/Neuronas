<html>
    <head>
        <meta charset="utf-8">
        <title>NÃºmeros</title>
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/css/bootstrap.min.css" integrity="sha384-rwoIResjU2yc3z8GV/NPeZWAv56rSmLldC3R/AZzGRnGxQQKnKkoFVhFQhNUwEyJ" crossorigin="anonymous">
        <link rel="stylesheet" type="text/css" href="css/style.css">
        <script type="text/javascript" src='Third-Party/encog-javascript/encog.js'></script>
        <script type="text/javascript" src='Third-Party/encog-javascript/encog-widget.js'></script>
        <script src="https://code.jquery.com/jquery-3.1.1.slim.min.js" integrity="sha384-A7FZj7v+d/sdmMqp/nOQwliLvUsJfDHW+k9Omg/a/EheAdgtzNs3hpfag6Ed950n" crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/tether/1.4.0/js/tether.min.js" integrity="sha384-DztdAPBWPRXSA/3eYEEUWrWCy7G5KFbe8fFjk5JAIxUYHKkDx6Qin1DkWx51bBrb" crossorigin="anonymous"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/js/bootstrap.min.js" integrity="sha384-vBWWzlZJ8ea9aCX4pEW3rVHjgjt7zpkNpZk+02D9phzyeVkE+jo0ieGizqPLForn" crossorigin="anonymous"></script>
        <script type="text/javascript" src='canvas.js'></script>
    </head>  
    <body>
        <div class="container" padding="2">
            <header>
                <h1>Perceptrones</h1>    
            </header>            
        </div>
        <div class="container">
            <div class="row align-items-center align-content-lg-center vertical-align">
                <div class="col">
                   <table cellpadding="0" cellspacing="0" style="width: 80%">
                        <thead>
                            <tr>
                                <th class="text-center">1</th>
                                <th class="text-center">2</th>
                                <th class="text-center">3</th>
                                <th class="text-center">4</th>
                                <th class="text-center">5</th>
                            </tr>    
                        </thead>
                        <tr>
                            <td id="1" class="noSeleccionado"></td>
                            <td id="2" class="noSeleccionado"></td>
                            <td id="3" class="noSeleccionado"></td>
                            <td id="4" class="noSeleccionado"></td>
                            <td id="5" class="noSeleccionado"></td>
                        </tr>
                        <tr>
                            <td id="6" class="noSeleccionado"></td>
                            <td id="7" class="noSeleccionado"></td>
                            <td id="8" class="noSeleccionado"></td>
                            <td id="9" class="noSeleccionado"></td>
                            <td id="10" class="noSeleccionado"></td>
                        </tr>
                        <tr>
                            <td id="11" class="noSeleccionado"></td>
                            <td id="12" class="noSeleccionado"></td>
                            <td id="13" class="noSeleccionado"></td>
                            <td id="14" class="noSeleccionado"></td>
                            <td id="15" class="noSeleccionado"></td>
                        </tr>
                        <tr>
                            <td id="16" class="noSeleccionado"></td>
                            <td id="17" class="noSeleccionado"></td>
                            <td id="18" class="noSeleccionado"></td>
                            <td id="19" class="noSeleccionado"></td>
                            <td id="20" class="noSeleccionado"></td>
                        </tr>
                        <tr>
                            <td id="21" class="noSeleccionado"></td>
                            <td id="22" class="noSeleccionado"></td>
                            <td id="23" class="noSeleccionado"></td>
                            <td id="24" class="noSeleccionado"></td>
                            <td id="25" class="noSeleccionado"></td>
                        </tr>
                        <tr>
                            <td id="26" class="noSeleccionado"></td>
                            <td id="27" class="noSeleccionado"></td>
                            <td id="28" class="noSeleccionado"></td>
                            <td id="29" class="noSeleccionado"></td>
                            <td id="30" class="noSeleccionado"></td>
                        </tr>
                        <tr>
                            <td id="31" class="noSeleccionado"></td>
                            <td id="32" class="noSeleccionado"></td>
                            <td id="33" class="noSeleccionado"></td>
                            <td id="34" class="noSeleccionado"></td>
                            <td id="35" class="noSeleccionado"></td>
                        </tr>
                    </table>
                </div>
                <div class="col">
                    <table cellpadding="0" cellspacing="0" style="width: 80%" border="1">
                        <thead>
                            <tr id="tHeaders">
                            <th class="text-center">Clase</th>
                            <th class="text-center">Salida</th>
                            <th class="text-center">Salida redondeada</th>
                        </tr>    
                        </thead>
                        <tr id="c1">
                            <td>0</td>
                            <td>0</td>
                            <td>0</td>
                        </tr>
                        <tr id="c2">
                            <td>0</td>
                            <td>0</td>
                            <td>0</td>
                        </tr>
                        <tr id="c3">
                            <td>0</td>
                            <td>0</td>
                            <td>0</td>
                        </tr>
                        <tr id="c4">
                            <td>0</td>
                            <td>0</td>
                            <td>0</td>
                        </tr>
                        <tr id="c5">
                            <td>0</td>
                            <td>0</td>
                            <td>0</td>
                        </tr>
                        <tr id="c6">
                            <td>0</td>
                            <td>0</td>
                            <td>0</td>
                        </tr>
                        <tr id="c7">
                            <td>0</td>
                            <td>0</td>
                            <td>0</td>
                        </tr>
                        <tr id="c8">
                            <td>0</td>
                            <td>0</td>
                            <td>0</td>
                        </tr>
                        <tr id="c9">
                            <td>0</td>
                            <td>0</td>
                            <td>0</td>
                        </tr>
                        <tr id="c10">
                            <td>0</td>
                            <td>0</td>
                            <td>0</td>
                        </tr>
                        <tr id="c11">
                            <td>0</td>
                            <td>0</td>
                            <td>0</td>
                        </tr>
                        <tr id="c12">
                            <td>0</td>
                            <td>0</td>
                            <td>0</td>
                        </tr>
                    </table>        
                </div>
            </div>
        </div>
        <div class="container text-center">
            <button onclick="clasificar()" class="btn-outline-primary" type="button">Clasificar</button>
            <button onclick="limpiar()" class="btn-outline-primary" type="button">Limpiar</button>    
        </div>
        <div class="container text-center" padding ="1">
            <label>La entrada pertenece a la clase: </label>
            <input type="text" name="resultado">
        </div>
        <script>

            var valE = 0;
            var valS = 1;

            var entradaCero   = [valE, valS, valS, valS, valE, 
                                 valS, valE, valE, valE, valS, 
                                 valS, valE, valE, valS, valS, 
                                 valS, valE, valS, valE, valS, 
                                 valS, valS, valE, valE, valS, 
                                 valS, valE, valE, valE, valS, 
                                 valE, valS, valS, valS, valE];

            var entradaUno    = [valE, valE, valS, valE, valE, 
                                 valE, valS, valS, valE, valE, 
                                 valE, valE, valS, valE, valE, 
                                 valE, valE, valS, valE, valE, 
                                 valE, valE, valS, valE, valE, 
                                 valE, valE, valS, valE, valE, 
                                 valE, valS, valS, valS, valE];

            var entradaDos    = [valE, valS, valS, valS, valE, 
                                 valS, valE, valE, valE, valS, 
                                 valE, valE, valE, valE, valS, 
                                 valE, valE, valE, valS, valE,
                                 valE, valE, valS, valE, valE, 
                                 valE, valS, valE, valE, valE, 
                                 valS, valS, valS, valS, valS];

            var entradaTres   = [valS, valS, valS, valS, valS, 
                                 valE, valE, valE, valS, valE, 
                                 valE, valE, valS, valE, valE, 
                                 valE, valE, valE, valS, valE, 
                                 valE, valE, valE, valE, valS, 
                                 valS, valE, valE, valE, valS, 
                                 valE, valS, valS, valS, valE];

            var entradaCuatro = [valE, valE, valE, valS, valE, 
                                 valE, valE, valS, valS, valE, 
                                 valE, valS, valE, valS, valE, 
                                 valS, valE, valE, valS, valE, 
                                 valS, valS, valS, valS, valS, 
                                 valE, valE, valE, valS, valE, 
                                 valE, valE, valE, valS, valE];

            var entradaCinco = [valS, valS, valS, valS, valS, 
                                valS, valE, valE, valE, valE, 
                                valS, valS, valS, valS, valE, 
                                valE, valE, valE, valE, valS, 
                                valE, valE, valE, valE, valS, 
                                valS, valE, valE, valE, valS, 
                                valE, valS, valS, valS, valE];

            var entradaSeis = [valE, valE, valS, valS, valE, 
                               valE, valS, valE, valE, valE, 
                               valS, valE, valE, valE, valE, 
                               valS, valS, valS, valS, valE, 
                               valS, valE, valE, valE, valS, 
                               valS, valE, valE, valE, valS, 
                               valE, valS, valS, valS, valE];

            var entradaSiete = [valS, valS, valS, valS, valS, 
                                valE, valE, valE, valE, valS, 
                                valE, valE, valE, valS, valE, 
                                valE, valE, valS, valE, valE, 
                                valE, valS, valE, valE, valE, 
                                valE, valS, valE, valE, valE,
                                valE, valS, valE, valE, valE];

            var entradaOcho = [valE, valS, valS, valS, valE, 
                               valS, valE, valE, valE, valS, 
                               valS, valE, valE, valE, valS, 
                               valE, valS, valS, valS, valE, 
                               valS, valE, valE, valE, valE, 
                               valS, valE, valE, valE, valS, 
                               valE, valS, valS, valS, valE];

            var entradaNueve = [valE, valS, valS, valS, valE, 
                                valS, valE, valE, valE, valS, 
                                valS, valE, valE, valE, valS, 
                                valE, valS, valS, valS, valS, 
                                valE, valE, valE, valE, valS, 
                                valE, valE, valE, valS, valE, 
                                valE, valS, valS, valE, valE];

            var entradaGuion = [valE, valE, valE, valE, valE, 
                                valE, valE, valE, valE, valE, 
                                valE, valE, valE, valE, valE, 
                                valS, valS, valS, valS, valS, 
                                valE, valE, valE, valE, valE, 
                                valE, valE, valE, valE, valE, 
                                valE, valE, valE, valE, valE];

            var entradaPunto = [valE, valE, valE, valE, valE, 
                                valE, valE, valE, valE, valE, 
                                valE, valE, valE, valE, valE, 
                                valE, valE, valE, valE, valE, 
                                valE, valE, valE, valE, valE, 
                                valE, valS, valS, valE, valE,
                                valE, valS, valS, valE, valE];

            var salidaCero =   [valS,valE,valE,valE,valE,valE,valE,valE,valE,valE,valE,valE];
            var salidaUno =    [valE,valS,valE,valE,valE,valE,valE,valE,valE,valE,valE,valE];
            var salidaDos =    [valE,valE,valS,valE,valE,valE,valE,valE,valE,valE,valE,valE];
            var salidaTres =   [valE,valE,valE,valS,valE,valE,valE,valE,valE,valE,valE,valE];
            var salidaCuatro = [valE,valE,valE,valE,valS,valE,valE,valE,valE,valE,valE,valE];
            var salidaCinco =  [valE,valE,valE,valE,valE,valS,valE,valE,valE,valE,valE,valE];
            var salidaSeis =   [valE,valE,valE,valE,valE,valE,valS,valE,valE,valE,valE,valE];
            var salidaSiete =  [valE,valE,valE,valE,valE,valE,valE,valS,valE,valE,valE,valE];
            var salidaOcho =   [valE,valE,valE,valE,valE,valE,valE,valE,valS,valE,valE,valE];
            var salidaNueve =  [valE,valE,valE,valE,valE,valE,valE,valE,valE,valS,valE,valE];
            var salidaGuion =  [valE,valE,valE,valE,valE,valE,valE,valE,valE,valE,valS,valE];
            var salidaPunto =  [valE,valE,valE,valE,valE,valE,valE,valE,valE,valE,valE,valS];

            var entradasRed = [entradaCero,   entradaUno,   entradaDos,   entradaTres,
                               entradaCuatro, entradaCinco, entradaSeis,  entradaSiete,
                               entradaOcho,   entradaNueve, entradaPunto, entradaGuion];

            var salidasRed = [salidaCero,   salidaUno,   salidaDos,   salidaTres,
                              salidaCuatro, salidaCinco, salidaSeis,  salidaSiete,
                              salidaOcho,   salidaNueve, salidaPunto, salidaGuion];
			/* Red Neuronal de Antes 
            var redNeuronal = new RedNeuronal(0.2, false);
            redNeuronal.construir([35,30,25,20,15,12], 0.8);

            //entrenamiento de la red (Tiempo estimado de procesamiento: 06:08)
            var fechaInicio = new Date();


            for (var i = 0; i < 1500; i++)
            {
                for (var j = 0; j < entradasRed.length; j++)
                {
                    redNeuronal.entrenar(entradasRed[j], salidasRed[j]);
                }

                console.log("iteracion: " + i + " " + redNeuronal.getError());
            }

            var fechaFin = new Date();
            var dif= fechaFin - fechaInicio; 
            var difSeg = Math.floor(dif/1000);
            var segundos = difSeg % 60; 
            var difMin = Math.floor(difSeg/60); 
            var minutos = difMin % 60; 
            var difHs = Math.floor(difMin/60); 
            var horas = difHs % 24;

            console.log(horas+":"+minutos+":"+segundos);

            console.log(redNeuronal.getError());

            //redNeuronal.logString();
            */
           
           /* Creacion de la red de ENCOG */
           var network = ENCOG.BasicNetwork.create( [
			  ENCOG.BasicLayer.create(ENCOG.ActivationSigmoid.create(), 35, 1),
			  ENCOG.BasicLayer.create(ENCOG.ActivationSigmoid.create(), 20, 1),
			  ENCOG.BasicLayer.create(ENCOG.ActivationSigmoid.create(), 15, 1),
			  ENCOG.BasicLayer.create(ENCOG.ActivationSigmoid.create(), 12, 1)] );
			network.randomize();

			var train = ENCOG.PropagationTrainer.create(network,entradasRed,salidasRed,"RPROP",0,0);

			var iteration = 1;
			do
			{
				train.iteration();
				var str = "Training Iteration #" + iteration + ", Error: " + train.error;
				console.log(str);
				iteration++;
			} 
			while(iteration < 1000 && train.error > 0.0001);
            
            for(i=1,j=35;i<=j;i++){
                document.getElementById(i).onclick = function(){
                    if(this.getAttribute("class") == "noSeleccionado"){
                        this.setAttribute("class","seleccionado");
                        var id = this.getAttribute("id");
                        document.getElementById("peso"+id).innerHTML=valS;
                    }
                    else{
                        this.setAttribute("class","noSeleccionado");
                        var id = this.getAttribute("id");
                        document.getElementById("peso"+id).innerHTML=valE;
                    }
                };
            }

            function clasificar()
            {
                clases = ["0", "1", "2", "3", "4", "5", "6", "7", "8", "9", "Punto", "Guion"];

                var arregloEntradas=[];
                for(i=1,j=35;i<=j;i++){
                    var valor = parseFloat(document.getElementById("peso"+i).innerHTML);
                    arregloEntradas.push(valor);
                }

				var output = [];
				network.compute(arregloEntradas,output);

                var mayor    = 0;
                var posMayor = 0;

                for (var i = 0; i < output.length; i++)
                {
                    var valor = output[i];

                    if (valor > mayor)
                    {   
                        posMayor = i;
                        mayor    = valor;
                    }
    
                    var str = "Clase: " + clases[i] + " Output: " + valor;

					console.log(str);
                }

                console.log("Patron mas parecido: '" + clases[posMayor] + "' " + mayor);
            }
            function limpiar(){
                for(i=1,j=35;i<=j;i++){
                    var cuadro = document.getElementById(i);
                    cuadro.setAttribute("class","noSeleccionado");
                    var id = cuadro.getAttribute("id");
                    document.getElementById("peso"+id).innerHTML=valE;
                }
            }

            limpiar();
        </script>
    </body>
</html>